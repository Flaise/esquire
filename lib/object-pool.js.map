{"version":3,"sources":["../src/object-pool.js"],"names":[],"mappings":"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","file":"src/object-pool.js","sourcesContent":["'use strict'\n\nvar sanity = require('./sanity')\n\n\nfunction ObjectPool(constructor) {\n    this.constructor = constructor\n    this.alive = []\n    this.dead = []\n    this.aliveCount = 0\n    this.deadCount = 0\n    this._iterating = false\n}\nmodule.exports = exports = ObjectPool\n\nObjectPool.prototype.make = function(/*varargs*/) {\n    sanity(!this._iterating)\n    if(this.deadCount) {\n        this.deadCount -= 1\n        var obj = this.dead[this.deadCount]\n        sanity(!obj._doNotDelete)\n        this.constructor.apply(obj, arguments)\n        if(sanity.throws)\n            this.dead[this.deadCount] = undefined\n    }\n    else {\n        var obj = Object.create(this.constructor.prototype)\n        this.constructor.apply(obj, arguments)\n    }\n    \n    this.alive[this.aliveCount] = obj\n    this.aliveCount += 1\n    return obj\n}\nObjectPool.prototype.clear = function() {\n    sanity(!this._iterating)\n    var initialCount = this.aliveCount\n    for(var i = 0; i < initialCount; i += 1) {\n        var obj = this.alive[i]\n        this.dead[this.deadCount] = obj\n        this.deadCount += 1\n    }\n    this.aliveCount = 0\n}\nObjectPool.prototype.remove = function(removals) {\n    sanity(!this._iterating)\n    var shiftBy = 0\n    var initialCount = this.aliveCount\n    for(var i = 0; i < initialCount; i += 1) {\n        var obj = this.alive[i]\n        \n        var deleting = false\n        if(shiftBy < removals.length)\n            for(var j = 0; j < removals.length; j += 1) {\n                if(removals[j] === obj) {\n                    deleting = true\n                    break\n                }\n            }\n\n        if(deleting) {\n            this.dead[this.deadCount] = obj\n            this.deadCount += 1\n            shiftBy += 1\n        }\n        else if(shiftBy && i - shiftBy >= 0)\n            this.alive[i - shiftBy] = obj\n    }\n    this.aliveCount -= shiftBy\n    sanity(shiftBy === removals.length)\n}\nObjectPool.prototype.removeAt = function(index) {\n    sanity(!this.alive[index]._doNotDelete)\n    sanity(!this._iterating)\n    this.dead[this.deadCount] = this.alive[index]\n    this.deadCount += 1\n    \n    var initialCount = this.aliveCount\n    for(var i = index + 1; i < initialCount; i += 1) {\n        var obj = this.alive[i]\n        this.alive[i - 1] = obj\n    }\n    this.aliveCount -= 1\n}\n"]}