{"version":3,"sources":["../../src/scene/avatar.js"],"names":[],"mappings":"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","file":"src/scene/avatar.js","sourcesContent":["'use strict'\n\nvar sanity = require('./sanity') // TODO: factor into external library\nvar is = require('./is')\n\n\nfunction Avatar(avatars) {\n    this._layer = undefined\n    sanity.constant(this, '_node', avatars.alive.addLast(this))\n    \n    if(sanity.throws)\n        this._avatars = avatars\n}\nmodule.exports = exports = Avatar\n\nObject.defineProperty(Avatar.prototype, 'layer', {\n    get: function() { return this._layer },\n    set: function(value) {\n        sanity(!(this._avatars && this._avatars._iterating))\n        if(sanity(is.number(value)))\n            return\n        if(value === this._layer)\n            return\n        this._layer = value\n        this._shift()\n    }\n})\n\nAvatar.prototype._shift = function() {\n    if(sanity(!this.removed))\n        return\n    while(true) {\n        var prev = this._node.prev\n        var prev_prev = prev.prev\n        var next = this._node.next\n        \n        if(!prev.value)\n            break\n        if(is.defined(prev.value._layer) && prev.value._layer <= this._layer)\n            break\n        \n        prev.next = next\n        prev_prev.next = this._node\n        prev.prev = this._node\n    }\n    \n    while(true) {\n        var prev = this._node.prev\n        var next = this._node.next\n        var next_next = next.next\n        \n        if(!next.value)\n            break\n        if(is.nullish(next.value._layer) || next.value._layer >= this._layer)\n            break\n        \n        next.prev = prev\n        next_next.prev = this._node\n        next.next = this._node\n    }\n}\n\nObject.defineProperty(Avatar.prototype, 'removed', {get: function() { return this._node.removed }})\n\nAvatar.prototype._avatar_remove = function() {\n    this._node.remove()\n}\nAvatar.prototype.remove = Avatar.prototype._avatar_remove\n\nAvatar.prototype.draw = function _abstract() {\n    sanity(false)\n}\n"]}