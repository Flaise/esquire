{"version":3,"sources":["../../src/scene/avatar.js"],"names":[],"mappings":";;;;;;;;;;;;kBAAe,OAAO;;;;IAED,MAAM;AACZ,aADM,MAAM,CACX,OAAO,EAAE;8BADJ,MAAM;;AAEnB,YAAI,CAAC,MAAM,GAAG,SAAS,CAAA;AACvB,YAAI,CAAC,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;KAC3C;;iBAJgB,MAAM;;eAqBjB,kBAAG;AACL,gBAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAA;SACtB;;;eAEG,cAAC,OAAO,EAAE;AACV,mBAAO,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAA;SAC1D;;;eAEK,kBAAG;;;AAGL,mBAAM,IAAI,EAAE;AACR,oBAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;AAC5B,oBAAM,SAAS,GAAG,IAAI,CAAC,IAAI,CAAA;AAC3B,oBAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;;AAE5B,oBAAG,CAAC,IAAI,CAAC,KAAK,EACV,MAAK;AACT,oBAAG,gBAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,EAChE,MAAK;;AAET,oBAAI,CAAC,IAAI,GAAG,IAAI,CAAA;AAChB,yBAAS,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAA;AAC3B,oBAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAA;aACzB;;AAED,mBAAM,IAAI,EAAE;AACR,oBAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;AAC5B,oBAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;AAC5B,oBAAM,SAAS,GAAG,IAAI,CAAC,IAAI,CAAA;;AAE3B,oBAAG,CAAC,IAAI,CAAC,KAAK,EACV,MAAK;AACT,oBAAG,gBAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,EAChE,MAAK;;AAET,oBAAI,CAAC,IAAI,GAAG,IAAI,CAAA;AAChB,yBAAS,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAA;AAC3B,oBAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAA;aACzB;SACJ;;;aAvDQ,eAAG;AACR,mBAAO,IAAI,CAAC,MAAM,CAAA;SACrB;aACQ,aAAC,KAAK,EAAE;;;AAGb,gBAAG,KAAK,KAAK,IAAI,CAAC,MAAM,EACpB,OAAM;AACV,gBAAI,CAAC,MAAM,GAAG,KAAK,CAAA;AACnB,gBAAI,CAAC,MAAM,EAAE,CAAA;SAChB;;;aAEU,eAAG;AACV,mBAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAA;SAC5B;;;WApBgB,MAAM;;;qBAAN,MAAM","file":"src/scene/avatar.js","sourcesContent":["import is from '../is'\n\nexport default class Avatar {\n    constructor(avatars) {\n        this._layer = undefined\n        this._node = avatars.alive.addLast(this)\n    }\n    \n    get layer() {\n        return this._layer\n    }\n    set layer(value) {\n        // SANITY(!(this._avatars && this._avatars._iterating)) // TODO\n        // SANITY(is.number(value))\n        if(value === this._layer)\n            return\n        this._layer = value\n        this._shift()\n    }\n    \n    get removed() {\n        return this._node.removed\n    }\n    remove() {\n        this._node.remove()\n    }\n    \n    draw(context) {\n        console.warn('Called abstract function Avatar.draw().')\n    }\n    \n    _shift() {\n        // SANITY(!this.removed) // TODO\n        \n        while(true) {\n            const prev = this._node.prev\n            const prev_prev = prev.prev\n            const next = this._node.next\n            \n            if(!prev.value)\n                break\n            if(is.defined(prev.value._layer) && prev.value._layer <= this._layer)\n                break\n            \n            prev.next = next\n            prev_prev.next = this._node\n            prev.prev = this._node\n        }\n        \n        while(true) {\n            const prev = this._node.prev\n            const next = this._node.next\n            const next_next = next.next\n            \n            if(!next.value)\n                break\n            if(is.nullish(next.value._layer) || next.value._layer >= this._layer)\n                break\n            \n            next.prev = prev\n            next_next.prev = this._node\n            next.next = this._node\n        }\n    }\n}\n"]}