{"version":3,"sources":["../../src/scene/pattern-avatar.js"],"names":[],"mappings":"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","file":"src/scene/pattern-avatar.js","sourcesContent":["'use strict'\n\nvar DefaultAvatar = require('./default-avatar')\nvar sanity = require('./sanity')\nvar is = require('./is')\n\n\nfunction PatternAvatar(avatars, camera, icon, parallaxFactor) {\n    DefaultAvatar.call(this, avatars)\n    sanity(icon)\n    this.camera = camera\n    this.parallaxX = parallaxFactor\n    this.parallaxY = parallaxFactor\n    this.icon = icon\n}\nPatternAvatar.prototype = Object.create(DefaultAvatar.prototype)\nmodule.exports = exports = PatternAvatar\n\nPatternAvatar.prototype.draw = function(context) {\n    if(sanity(this.icon))\n        return\n    \n    if(this.opacity.curr !== 1) {\n        var prevGlobalAlpha = context.globalAlpha\n        context.globalAlpha = esquire.clamp(this.opacity.curr, 0, 1)\n    }\n    \n    var cameraLeft = this.camera.x.curr - this.camera.w.curr * this.camera.anchorX.curr\n    var cameraRight = this.camera.x.curr + this.camera.w.curr * (1 - this.camera.anchorX.curr)\n    var w = this.w.curr\n    if(sanity(w > 0))\n        return\n    var startX = this.x.curr - w\n    startX += this.camera.x.curr * this.parallaxX - this.parallaxX\n    while(startX + w < cameraLeft)\n        startX += w\n    while(startX > cameraLeft)\n        startX -= w\n    \n    var cameraTop = this.camera.y.curr - this.camera.h.curr * this.camera.anchorY.curr\n    var cameraBottom = this.camera.y.curr + this.camera.h.curr * (1 - this.camera.anchorY.curr)\n    var h = this.h.curr\n    if(sanity(h > 0))\n        return\n    var startY = this.y.curr - h\n    startY += this.camera.y.curr * this.parallaxY - this.parallaxY\n    while(startY + h < cameraTop)\n        startY += h\n    while(startY > cameraTop)\n        startY -= h\n    \n    for(var y = startY; y < cameraBottom; y += h)\n        for(var x = startX; x < cameraRight; x += w)\n            this.icon.draw(context, x + w/2, y + h/2, w, h)\n    \n    if(prevGlobalAlpha !== undefined)\n        context.globalAlpha = prevGlobalAlpha\n}\n"]}